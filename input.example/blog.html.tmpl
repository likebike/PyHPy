<%inherit file="_master.tmpl" />
<%! import os, makofw, mako %>

%if self.URL()=='/blog.html.tmpl':

%else:
${next.body()}
<hr class=afterPost />
<h1>Other Posts:</h1>
%endif

<ul class=posts>
%for i,(date,mdFilename,meta,title,image) in enumerate(self.getPosts()):
    <li class="post ${'post-useSep' if i>0 else ''}">
        <a href="${self.URL('/blog/%s'%(mdFilename[:-3],), timestamp=None)}">
            <img class="postImg roundBorder" src="${self.URL(makofw.thumb(self.ROOT_DIR(), image, height=150))}" />
            <div class=postTitle>${title}</div>
            <div class=postSummary>${meta['summary']}</div>
            <div class=postMeta><span class=date>${meta['date']}</span> - by <span class=author>${meta['author']}</span></div>
        </a>
        <div class=clearFloats></div>
    </li>
%endfor
</ul>

<%block name='PAGE_CSS'>
  <link rel="stylesheet" type="text/css" href="${self.URL('/static/css/blog.css')}">
</%block>
<%def name="getPosts()"><% return reversed(sorted([self.postInfo(x) for x in os.listdir(os.path.join(self.ROOT_DIR(), 'blog')) if x.endswith('.html.md')])) %></%def>
<%def name="postInfo(mdFilename)"><%
     assert mdFilename.endswith('.html.md')
     meta = makofw.meta(os.path.join(self.ROOT_DIR(), 'blog', mdFilename))
     title = mdFilename[:-8].replace('_', ' ')
     return meta['date'], mdFilename, meta, title, meta['image']
%></%def>
